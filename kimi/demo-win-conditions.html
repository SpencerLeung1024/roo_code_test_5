<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monopoly Win Conditions Demo</title>
    <link rel="stylesheet" href="css/main.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 20px;
        }
        
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #3498db;
        }
        
        .control-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        
        .panel h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .player-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .player-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .player-card h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        .player-stats {
            font-size: 14px;
            line-height: 1.5;
        }
        
        .btn {
            padding: 8px 16px;
            margin: 2px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-success {
            background: #2ecc71;
            color: white;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-warning {
            background: #f39c12;
            color: white;
        }
        
        .win-conditions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .condition-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .game-status {
            background: #e8f4f8;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .rankings {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .ranking-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .ranking-item:last-child {
            border-bottom: none;
        }
        
        .ranking-item.bankrupt {
            background: #ffe6e6;
            opacity: 0.7;
        }
        
        .rank {
            font-weight: bold;
            color: #3498db;
        }
        
        .net-worth {
            font-weight: bold;
            color: #27ae60;
        }
        
        .properties {
            color: #7f8c8d;
        }
        
        .monopolies {
            color: #e67e22;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="header">
            <h1>ðŸŽ² Monopoly Win Conditions Demo</h1>
            <p>Test and configure win conditions for the Monopoly game</p>
        </div>

        <div class="control-panel">
            <div class="panel">
                <h3>Game Controls</h3>
                <button class="btn btn-primary" onclick="startGame()">Start New Game</button>
                <button class="btn btn-success" onclick="configureWinConditions()">Configure Win Conditions</button>
                <button class="btn btn-warning" onclick="simulateTurn()">Simulate Turn</button>
                <button class="btn btn-danger" onclick="endGame()">End Game</button>
            </div>
            
            <div class="panel">
                <h3>Game Status</h3>
                <div id="gameStatus">
                    <p><strong>Status:</strong> <span id="gameStatusText">Not Started</span></p>
                    <p><strong>Round:</strong> <span id="currentRound">0</span></p>
                    <p><strong>Duration:</strong> <span id="gameDuration">0:00</span></p>
                    <p><strong>Active Players:</strong> <span id="activePlayers">0</span></p>
                </div>
            </div>
        </div>

        <div class="panel">
            <h3>Player Controls</h3>
            <div id="playerControls" class="player-controls">
                <!-- Player cards will be generated here -->
            </div>
        </div>

        <div class="panel">
            <h3>Current Rankings</h3>
            <div id="rankings" class="rankings">
                <!-- Rankings will be displayed here -->
            </div>
        </div>

        <div class="panel">
            <h3>Win Conditions</h3>
            <div id="winConditions" class="win-conditions">
                <!-- Win conditions will be displayed here -->
            </div>
        </div>
    </div>

    <!-- Win Condition Configuration Modal -->
    <div id="configModal" class="modal-overlay">
        <div class="modal">
            <h3>Configure Win Conditions</h3>
            <div id="configContent">
                <!-- Configuration content will be generated -->
            </div>
            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="saveConfig()">Save</button>
                <button class="btn btn-secondary" onclick="closeConfig()">Cancel</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { GameEngine } from './js/engine/GameEngine.js';
        import { WinConditionConfigUI } from './js/ui/WinConditionConfigUI.js';
        
        let gameEngine = null;
        let configUI = null;
        let gameInterval = null;

        // Initialize demo
        async function initDemo() {
            gameEngine = new GameEngine();
            await gameEngine.init();
            
            if (gameEngine.gameEndManager) {
                configUI = new WinConditionConfigUI(gameEngine.gameEndManager.winConditionChecker);
            }
            
            updateDisplay();
        }

        // Start new game
        async function startGame() {
            const gameConfig = {
                players: [
                    { name: 'Alice', token: 'hat' },
                    { name: 'Bob', token: 'car' },
                    { name: 'Charlie', token: 'ship' }
                ]
            };
            
            await gameEngine.startNewGame(gameConfig);
            startGameTimer();
            updateDisplay();
        }

        // Configure win conditions
        function configureWinConditions() {
            if (configUI) {
                configUI.show();
            }
        }

        // Simulate a turn
        function simulateTurn() {
            if (!gameEngine.isGameActive()) return;
            
            // Simulate player actions
            const currentPlayer = gameEngine.getCurrentPlayer();
            if (currentPlayer) {
                // Random money change
                const change = Math.floor(Math.random() * 200) - 100;
                currentPlayer.addMoney(change, 'Simulation');
                
                // Random property acquisition
                if (Math.random() < 0.3 && currentPlayer.properties.length < 5) {
                    currentPlayer.properties.push({
                        id: `prop_${Date.now()}`,
                        name: `Property ${currentPlayer.properties.length + 1}`,
                        colorGroup: ['brown', 'light-blue', 'pink'][Math.floor(Math.random() * 3)]
                    });
                }
            }
            
            gameEngine.endTurn();
            updateDisplay();
        }

        // End game
        function endGame() {
            if (gameEngine.gameEndManager) {
                gameEngine.gameEndManager.requestGameEnd('Manual game end');
            }
            stopGameTimer();
        }

        // Update display
        function updateDisplay() {
            const statusText = gameEngine.isGameActive() ? 'Active' : 'Not Started';
            document.getElementById('gameStatusText').textContent = statusText;
            document.getElementById('currentRound').textContent = gameEngine.getCurrentRound();
            document.getElementById('activePlayers').textContent = 
                gameEngine.playerManager ? gameEngine.playerManager.getActivePlayers().length : 0;
            
            updatePlayerControls();
            updateRankings();
            updateWinConditions();
        }

        // Update player controls
        function updatePlayerControls() {
            const container = document.getElementById('playerControls');
            container.innerHTML = '';
            
            if (!gameEngine.playerManager) return;
            
            gameEngine.playerManager.players.forEach(player => {
                const card = document.createElement('div');
                card.className = 'player-card';
                card.innerHTML = `
                    <h4>${player.name} ${player.isBankrupt ? '(Bankrupt)' : ''}</h4>
                    <div class="player-stats">
                        <div>Money: $${player.money}</div>
                        <div>Net Worth: $${player.getNetWorth()}</div>
                        <div>Properties: ${player.properties.length}</div>
                        <div>Position: ${player.position}</div>
                        ${player.inJail ? '<div style="color: red;">In Jail</div>' : ''}
                    </div>
                    <div style="margin-top: 10px;">
                        <button class="btn btn-success" onclick="addMoney('${player.id}', 100)">+$100</button>
                        <button class="btn btn-danger" onclick="addMoney('${player.id}', -100)">-$100</button>
                        <button class="btn btn-warning" onclick="declareBankrupt('${player.id}')">Bankrupt</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Update rankings
        function updateRankings() {
            const container = document.getElementById('rankings');
            container.innerHTML = '';
            
            if (!gameEngine.playerManager) return;
            
            const rankings = gameEngine.playerManager.getPlayerRankings();
            rankings.forEach((player, index) => {
                const item = document.createElement('div');
                item.className = `ranking-item ${player.isBankrupt ? 'bankrupt' : ''}`;
                item.innerHTML = `
                    <span class="rank">#${index + 1}</span>
                    <span class="name">${player.name}</span>
                    <span class="net-worth">$${player.getNetWorth()}</span>
                    <span class="properties">${player.properties.length} properties</span>
                `;
                container.appendChild(item);
            });
        }

        // Update win conditions
        function updateWinConditions() {
            const container = document.getElementById('winConditions');
            container.innerHTML = '';
            
            if (!gameEngine.gameEndManager) return;
            
            const config = gameEngine.gameEndManager.winConditionChecker.getConfiguration();
            Object.entries(config).forEach(([type, cfg]) => {
                const item = document.createElement('div');
                item.className = 'condition-item';
                item.innerHTML = `
                    <input type="checkbox" ${cfg.enabled ? 'checked' : ''} 
                           onchange="toggleWinCondition('${type}', this.checked)">
                    <span>${type.replace(/_/g, ' ')}</span>
                    ${cfg.targetAmount ? `<span>$${cfg.targetAmount}</span>` : ''}
                `;
                container.appendChild(item);
            });
        }

        // Add money to player
        function addMoney(playerId, amount) {
            const player = gameEngine.playerManager.getPlayerById(playerId);
            if (player) {
                player.addMoney(amount, 'Demo adjustment');
                updateDisplay();
            }
        }

        // Declare player bankrupt
        function declareBankrupt(playerId) {
            const player = gameEngine.playerManager.getPlayerById(playerId);
            if (player && !player.isBankrupt) {
                player.declareBankrupt();
                updateDisplay();
            }
        }

        // Game timer
        function startGameTimer() {
            gameInterval = setInterval(() => {
                if (gameEngine.isGameActive() && gameEngine.gameState.startTime) {
                    const duration = Date.now() - gameEngine.gameState.startTime;
                    const minutes = Math.floor(duration / 60000);
                    const seconds = Math.floor((duration % 60000) / 1000);
                    document.getElementById('gameDuration').textContent = 
                        `${minutes}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }

        function stopGameTimer() {
            if (gameInterval) {
                clearInterval(gameInterval);
                gameInterval = null;
            }
        }

        // Configuration functions
        function saveConfig() {
            // Configuration would be saved through the config UI
            closeConfig();
        }

        function closeConfig() {
            document.getElementById('configModal').style.display = 'none';
        }

        function toggleWinCondition(type, enabled) {
            if (gameEngine.gameEndManager) {
                gameEngine.gameEndManager.winConditionChecker.setWinConditionEnabled(type, enabled);
            }
        }

        // Make functions global for HTML onclick handlers
        window.startGame = startGame;
        window.configureWinConditions = configureWinConditions;
        window.simulateTurn = simulateTurn;
        window.endGame = endGame;
        window.addMoney = addMoney;
        window.declareBankrupt = declareBankrupt;
        window.saveConfig = saveConfig;
        window.closeConfig = closeConfig;

        // Initialize on load
        initDemo();
    </script>
</body>
</html>